/*         
PURPOSE:        Merge survey and app; 
                put in order required by template
PROGRAMMER:     K Wiggins
DATE:           08/25/2022
PROCESS:        Sabrina Lor exports REDCap, Qualtrics to S:drive>data_team as <file>_raw_;
NOTES:          
                Final result for upload should have 74 columns and be in order acc to &template_fields;
-----------------------------------------------------------------------------------------------------
CHANGE LOG
   Date         By      Purpose
1. 01/15/22     KW      Copied from Dionisia's original to not mess with it
2. 08/25/22     KW      Adapted from last iteration survey only, NORC

LAST RAN: 08/26/2022*/

* ROOT FOLDER  ---------------------------------------;
%let root = S:/FM/FM/Data_Management_Team;
* INCLUDE --------------------------------------------;
%include "&root/norc/code_folder/00_paths_lets.sas"; 
* has paths and all let statements for project;

* find template fields need to keep / order; 
proc sql;
select field
into :survey_order separated by ' '
from norc.templates
where template contains "Practice Survey";
quit;

%PUT by original order = &survey_order;

* Export files;
proc export data = norc.survey_baseline
    outfile = "&norc/survey_baseline_&datestamp"
    dbms=xlsx replace;
run;

proc export data = norc.survey_post
    outfile = "&norc/survey_post_&datestamp"
    dbms=xlsx replace;
run;

* delete BAK files created by PROC EXPORT;
filename bak  "&norc/survey_post_20220825.xlsx.bak";
filename bak2 "&norc/survey_baseline_20220825.xlsx.bak"; 

data _null_;
 rc = fdelete("bak");
 rc = fdelete("bak2");
run;

filename bak clear; 
filename bak2 clear;
