1272  /*
1273  PROGRAM:
1274  PURPOSE:         NORC upload
1275  PROGRAMMER:      K Wiggins
1276  DATE:            08/25/2022
1277  PROCESS:         Sabrina Lor exports REDCap, Qualtrics to S:drive>data_team as <file>_raw_;
1278  NOTES:           These are no longer in file but were in January:
1279                       - Use split_id_verify
1280                       - Use dupdelete remove 1's
1281                   Check:
1282                  - no keep / etc columns - all look complete - so kept all.
1283                  - Sent duplicate practice_id's to Sabrina Lor - practice_id 35, 141 this time
1284                   Final result for upload should have 74 columns and be in order acc to
1284! &template_fields;
1285  ------------------------------------------------------------------------------------------------
1285! -----
1286  CHANGE LOG
1287     Date         By      Purpose
1288  1. 01/15/22     KW      Copied from Dionisia's original to not mess with it
1289  2. 08/25/22     KW      Adapted from last iteration survey only, NORC
1290  3. 08/26/22     KW      Removed practice ID's 35, 141 until resolved: Need to get this file in
1290! first for other files' practice_ids
1291
1292  LAST RAN: 08/25/2022
1293  */
1294
1295  * Set global variables and function calls;
1296  * ROOT FOLDER  ---------------------------------------;
1297  %let root = S:/FM/FM/Data_Management_Team;
1298  * INCLUDE --------------------------------------------;
1299  %include "&root/norc/code_folder/00_paths_lets.sas";
SYMBOLGEN:  Macro variable ROOT resolves to S:/FM/FM/Data_Management_Team
SYMBOLGEN:  Macro variable ROOT resolves to S:/FM/FM/Data_Management_Team
SYMBOLGEN:  Macro variable ROOT resolves to S:/FM/FM/Data_Management_Team
SYMBOLGEN:  Macro variable ROOT resolves to S:/FM/FM/Data_Management_Team
SYMBOLGEN:  Macro variable ROOT resolves to S:/FM/FM/Data_Management_Team
SYMBOLGEN:  Macro variable ROOT resolves to S:/FM/FM/Data_Management_Team
SYMBOLGEN:  Macro variable FORM resolves to S:/FM/FM/Data_Management_Team/norc/background
SYMBOLGEN:  Macro variable FORM resolves to S:/FM/FM/Data_Management_Team/norc/background
SYMBOLGEN:  Macro variable SURVTEMPLATE resolves to
            S:/FM/FM/Data_Management_Team/norc/background/survey_template_order.xlsx
SYMBOLGEN:  Macro variable DATA resolves to S:/FM/FM/Data_Management_Team/raw data
SYMBOLGEN:  Macro variable DATA resolves to S:/FM/FM/Data_Management_Team/raw data
SYMBOLGEN:  Macro variable DATA resolves to S:/FM/FM/Data_Management_Team/raw data
SYMBOLGEN:  Macro variable DATA resolves to S:/FM/FM/Data_Management_Team/raw data
SYMBOLGEN:  Macro variable DATA resolves to S:/FM/FM/Data_Management_Team/raw data
SYMBOLGEN:  Macro variable DATA resolves to S:/FM/FM/Data_Management_Team/raw data
SYMBOLGEN:  Macro variable DATA resolves to S:/FM/FM/Data_Management_Team/raw data
SYMBOLGEN:  Macro variable ONEDRIVE resolves to C:/Users/wigginki/OneDrive - The University of
            Colorado Denver/Documents/projects
NOTE: Format PCTFMT is already on the library WORK.FORMATS.
NOTE: Format PCTFMT has been output.

NOTE: PROCEDURE FORMAT used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds


NOTE: Overwriting existing template/link: Base.Freq.OneWayList
NOTE: TABLE 'Base.Freq.OneWayList' has been saved to: SASUSER.TEMPLAT
NOTE: PROCEDURE TEMPLATE used (Total process time):
      real time           0.04 seconds
      cpu time            0.04 seconds



NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds


SYMBOLGEN:  Macro variable DATESTAMP resolves to 20220826
20220826
SYMBOLGEN:  Macro variable NORC resolves to S:/FM/FM/Data_Management_Team/norc/results
NOTE: Libref NORC was successfully assigned as follows:
      Engine:        V9
      Physical Name: S:\FM\FM\Data_Management_Team\norc\results
1371           *has paths and all let statements for project;
1372
1373  proc import
1374          file = "&survey."
SYMBOLGEN:  Macro variable SURVEY resolves to S:/FM/FM/Data_Management_Team/raw
            data/FASTPracticeSurvey_raw_08222022.csv
1375          out = survey0
1376          dbms = csv replace;
1377  run;

dqstring="Dr. lu Family Medicine, PLLC"
fmt=
dqstring=" -1"
fmt=
dqstring="SIM learning, RMHP learning , practice transformation team"
fmt=
dqstring="Northeast Colorado Family Medicine Associates, P.C."
fmt=
dqstring="Southern Colorado Medicine"
fmt=
dqstring=" -1"
fmt=
dqstring="Midvalley Family Practice"
fmt=
dqstring=" -1"
fmt=
dqstring="Zero Suicide"
fmt=
dqstring="Conifer Medical Center"
fmt=
dqstring=" -1"
fmt=
dqstring="Trey Medical Enterprises, Inc"
fmt=
dqstring=" -1"
fmt=
dqstring="It Matters"
fmt=
dqstring="Internal Medicine at Valley View"
fmt=
dqstring=" -1"
fmt=
dqstring=" -55"
fmt=
dqstring="Roaring Fork Family Practice"
fmt=
dqstring=" -1"
fmt=
dqstring="Mindfulness Training"
fmt=
dqstring="Highlands Health for Life"
fmt=
dqstring=" -1"
fmt=
dqstring="Aspen Internal Medicine Consultants"
fmt=
dqstring="Denver Family Medicine"
fmt=
dqstring=" -1"
fmt=
dqstring="Visiting Medical Clinic"
fmt=
dqstring="Boulder Creek Family Medicin"
fmt=
dqstring=" -1"
fmt=
dqstring="Northwest Family Medicine"
fmt=
dqstring=" -1"
fmt=
dqstring="Dakota Ridge Family Medicine"
fmt=
dqstring=" -1"
fmt=
dqstring="Family Medical Associates"
fmt=
dqstring="Internal Medical Associates of Lafayette"
fmt=
dqstring="Parker Family Care"
fmt=
dqstring=" -1"
fmt=
dqstring="Family Care Specialists"
fmt=
dqstring="IT Matters"
fmt=
1377!      *49,69;
1378   /**********************************************************************
1379   *   PRODUCT:   SAS
1380   *   VERSION:   9.4
1381   *   CREATOR:   External File Interface
1382   *   DATE:      26AUG22
1383   *   DESC:      Generated SAS Datastep Code
1384   *   TEMPLATE SOURCE:  (None Specified.)
1385   ***********************************************************************/
1386      data WORK.SURVEY0    ;
1387      %let _EFIERR_ = 0; /* set the ERROR detection macro variable */
1388      infile 'S:/FM/FM/Data_Management_Team/raw data/FASTPracticeSurvey_raw_08222022.csv'
1388! delimiter = ',' MISSOVER DSD lrecl=32767 firstobs=2 ;
1389         informat recordid best32. ;
1390         informat prac_entity_split_id best32. ;
1391         informat name $53. ;
1392         informat zip best32. ;
1393         informat state $1. ;
1394         informat survey_dtd yymmdd10. ;
1395         informat consulted___1 best32. ;
1396         informat consulted___2 best32. ;
1397         informat consulted___3 best32. ;
1398         informat consulted___4 best32. ;
1399         informat consulted___5 best32. ;
1400         informat consulted___6 best32. ;
1401         informat consulted___7 best32. ;
1402         informat consulted___8 best32. ;
1403         informat consulted_other $1. ;
1404         informat num_primary best32. ;
1405         informat fte_primary best32. ;
1406         informat num_psych best32. ;
1407         informat fte_psych best32. ;
1408         informat num_bhav best32. ;
1409         informat fte_bhav best32. ;
1410         informat num_nursing best32. ;
1411         informat num_front_office best32. ;
1412         informat num_peer_pvdr best32. ;
1413         informat num_pharm best32. ;
1414         informat num_other best32. ;
1415         informat patient_visits_wk best32. ;
1416         informat patient_provider_day best32. ;
1417         informat inpatientcare $5. ;
1418         informat race_white best32. ;
1419         informat race_black best32. ;
1420         informat race_native best32. ;
1421         informat race_hawaiian best32. ;
1422         informat race_asian best32. ;
1423         informat race_other best32. ;
1424         informat race_unknown best32. ;
1425         informat hispanic best32. ;
1426         informat non_hispanic best32. ;
1427         informat hispanic_unknown best32. ;
1428         informat age_0_17 best32. ;
1429         informat age_18_39 best32. ;
1430         informat age_40_59 best32. ;
1431         informat age_60_75 best32. ;
1432         informat age_76up best32. ;
1433         informat age_unk best32. ;
1434         informat gender_male best32. ;
1435         informat gender_female best32. ;
1436         informat gender_nonbinary best32. ;
1437         informat gender_none best32. ;
1438         informat demog_data best32. ;
1439         informat underserved best32. ;
1440         informat registry___1 best32. ;
1441         informat registry___2 best32. ;
1442         informat registry___3 best32. ;
1443         informat registry___4 best32. ;
1444         informat registry___5 best32. ;
1445         informat registry___6 best32. ;
1446         informat registry___7 best32. ;
1447         informat registry___8 best32. ;
1448         informat registry___9 best32. ;
1449         informat registry_config best32. ;
1450         informat teamlearn_formal_train $6. ;
1451         informat teamlearn_how_train best32. ;
1452         informat teamlearn_name_training best32. ;
1453         informat teamlearn_name_train_specify $60. ;
1454         informat train_together best32. ;
1455         informat train_small_teams best32. ;
1456         informat train_idv best32. ;
1457         informat fast_practice_survey_complete best32. ;
1458         format recordid best12. ;
1459         format prac_entity_split_id best12. ;
1460         format name $53. ;
1461         format zip best12. ;
1462         format state $1. ;
1463         format survey_dtd yymmdd10. ;
1464         format consulted___1 best12. ;
1465         format consulted___2 best12. ;
1466         format consulted___3 best12. ;
1467         format consulted___4 best12. ;
1468         format consulted___5 best12. ;
1469         format consulted___6 best12. ;
1470         format consulted___7 best12. ;
1471         format consulted___8 best12. ;
1472         format consulted_other $1. ;
1473         format num_primary best12. ;
1474         format fte_primary best12. ;
1475         format num_psych best12. ;
1476         format fte_psych best12. ;
1477         format num_bhav best12. ;
1478         format fte_bhav best12. ;
1479         format num_nursing best12. ;
1480         format num_front_office best12. ;
1481         format num_peer_pvdr best12. ;
1482         format num_pharm best12. ;
1483         format num_other best12. ;
1484         format patient_visits_wk best12. ;
1485         format patient_provider_day best12. ;
1486         format inpatientcare $5. ;
1487         format race_white best12. ;
1488         format race_black best12. ;
1489         format race_native best12. ;
1490         format race_hawaiian best12. ;
1491         format race_asian best12. ;
1492         format race_other best12. ;
1493         format race_unknown best12. ;
1494         format hispanic best12. ;
1495         format non_hispanic best12. ;
1496         format hispanic_unknown best12. ;
1497         format age_0_17 best12. ;
1498         format age_18_39 best12. ;
1499         format age_40_59 best12. ;
1500         format age_60_75 best12. ;
1501         format age_76up best12. ;
1502         format age_unk best12. ;
1503         format gender_male best12. ;
1504         format gender_female best12. ;
1505         format gender_nonbinary best12. ;
1506         format gender_none best12. ;
1507         format demog_data best12. ;
1508         format underserved best12. ;
1509         format registry___1 best12. ;
1510         format registry___2 best12. ;
1511         format registry___3 best12. ;
1512         format registry___4 best12. ;
1513         format registry___5 best12. ;
1514         format registry___6 best12. ;
1515         format registry___7 best12. ;
1516         format registry___8 best12. ;
1517         format registry___9 best12. ;
1518         format registry_config best12. ;
1519         format teamlearn_formal_train $6. ;
1520         format teamlearn_how_train best12. ;
1521         format teamlearn_name_training best12. ;
1522         format teamlearn_name_train_specify $60. ;
1523         format train_together best12. ;
1524         format train_small_teams best12. ;
1525         format train_idv best12. ;
1526         format fast_practice_survey_complete best12. ;
1527      input
1528                  recordid
1529                  prac_entity_split_id
1530                  name  $
1531                  zip
1532                  state  $
1533                  survey_dtd
1534                  consulted___1
1535                  consulted___2
1536                  consulted___3
1537                  consulted___4
1538                  consulted___5
1539                  consulted___6
1540                  consulted___7
1541                  consulted___8
1542                  consulted_other  $
1543                  num_primary
1544                  fte_primary
1545                  num_psych
1546                  fte_psych
1547                  num_bhav
1548                  fte_bhav
1549                  num_nursing
1550                  num_front_office
1551                  num_peer_pvdr
1552                  num_pharm
1553                  num_other
1554                  patient_visits_wk
1555                  patient_provider_day
1556                  inpatientcare  $
1557                  race_white
1558                  race_black
1559                  race_native
1560                  race_hawaiian
1561                  race_asian
1562                  race_other
1563                  race_unknown
1564                  hispanic
1565                  non_hispanic
1566                  hispanic_unknown
1567                  age_0_17
1568                  age_18_39
1569                  age_40_59
1570                  age_60_75
1571                  age_76up
1572                  age_unk
1573                  gender_male
1574                  gender_female
1575                  gender_nonbinary
1576                  gender_none
1577                  demog_data
1578                  underserved
1579                  registry___1
1580                  registry___2
1581                  registry___3
1582                  registry___4
1583                  registry___5
1584                  registry___6
1585                  registry___7
1586                  registry___8
1587                  registry___9
1588                  registry_config
1589                  teamlearn_formal_train  $
1590                  teamlearn_how_train
1591                  teamlearn_name_training
1592                  teamlearn_name_train_specify  $
1593                  train_together
1594                  train_small_teams
1595                  train_idv
1596                  fast_practice_survey_complete
1597      ;
1598      if _ERROR_ then call symputx('_EFIERR_',1);  /* set ERROR detection macro variable */
1599      run;

NOTE: The infile 'S:/FM/FM/Data_Management_Team/raw data/FASTPracticeSurvey_raw_08222022.csv' is:
      Filename=S:\FM\FM\Data_Management_Team\raw data\FASTPracticeSurvey_raw_08222022.csv,
      RECFM=V,LRECL=32767,File Size (bytes)=10977,
      Last Modified=22Aug2022:10:58:03,
      Create Time=22Aug2022:11:01:54

NOTE: 49 records were read from the infile 'S:/FM/FM/Data_Management_Team/raw
      data/FASTPracticeSurvey_raw_08222022.csv'.
      The minimum record length was 161.
      The maximum record length was 293.
NOTE: The data set WORK.SURVEY0 has 49 observations and 69 variables.
NOTE: DATA statement used (Total process time):
      real time           0.34 seconds
      cpu time            0.34 seconds


49 rows created in WORK.SURVEY0 from S:/FM/FM/Data_Management_Team/raw
data/FASTPracticeSurvey_raw_08222022.csv.



NOTE: WORK.SURVEY0 data set was successfully created.
NOTE: The data set WORK.SURVEY0 has 49 observations and 69 variables.
NOTE: PROCEDURE IMPORT used (Total process time):
      real time           1.03 seconds
      cpu time            0.96 seconds


1600
1601  proc sort data = survey0;
1602  by practice_id;
ERROR: Variable PRACTICE_ID not found.
1603  run;

NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds

1604
1605  *Per email thread with Sabrina re: multiple ID's, documented in doc file:;


1606  data survey0a;
1607  set  survey0;
1608  if name = "Aspen Internal Medicine Consultants" then prac_entity_split_id = 3106;
1609  if name = "Denver Family Medicine" then prac_entity_split_id = 2070;
1610  if name = "Internal Medical Associates of Lafayette" then prac_entity_split_id = 2601;
1611  run;

NOTE: There were 49 observations read from the data set WORK.SURVEY0.
NOTE: The data set WORK.SURVEY0A has 49 observations and 69 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds


1612
1613  proc print data = survey0a;
1614  var prac_entity_split_id name;
1615  run;

NOTE: There were 49 observations read from the data set WORK.SURVEY0A.
NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.04 seconds
      cpu time            0.03 seconds


1616
1617  proc sql;
1618  create table survey1 as
1619  select prac_entity_split_id as PRACTICE_ID
1620      , zip                   as ZIPCODE
1621      , consulted___1         as SURVEY_CONSULT_CLINICIAN
1622      , consulted___2         as SURVEY_CONSULT_BH
1623      , consulted___3         as SURVEY_CONSULT_OTHER_CLINICAL
1624      , consulted___4         as SURVEY_CONSULT_OFFICE_MANAGER
1625      , consulted___5         as SURVEY_CONSULT_OFFICE_STAFF
1626      , consulted___6         as SURVEY_CONSULT_PEER_PROVIDER
1627      , consulted___7         as SURVEY_CONSULT_PHARMACIST
1628      , consulted_other       as SURVEY_CONSULT_OTHER
1629      , num_primary           as TOTAL_PRIMARY_CARE
1630      , fte_primary           as FTE_PRIMARY_CARE
1631      , num_psych             as TOTAL_PSYCH
1632      , fte_psych             as FTE_PSYCH
1633      , num_bhav              as TOTAL_BH
1634      , fte_bhav              as FTE_BH
1635      , num_nursing           as TOTAL_DIRECT_PT_CARE
1636      , num_front_office      as TOTAL_OFFICE_STAFF
1637      , num_peer_pvdr         as TOTAL_PEER_PROVIDERS
1638      , num_pharm             as TOTAL_PHARMACIST
1639      , num_other             as TOTAL_OTHER
1640      , inpatientcare
1641      , patient_provider_day  as PATIENT_DAILY_NUMBER
1642      , race_white            as PERCENTAGE_WHITE
1643      , race_black            as PERCENTAGE_BLACK
1644      , race_native           as PERCENTAGE_AIAN
1645      , race_asian            as PERCENTAGE_ASIAN
1646      , race_hawaiian         as PERCENTAGE_NHPI
1647      , race_other            as PERCENTAGE_OTHER_MIXED
1648      , race_unknown          as PERCENTAGE_UNKNOWN
1649      , hispanic              as HISPANIC_LATINX_PERCENT
1650      , non_hispanic          as NON_HISPANIC_LATINX
1651      , hispanic_unknown      as HISPANIC_LATINX_UNKNOWN
1652      , age_0_17              as PATIENT_AGE_0_17
1653      , age_18_39             as PATIENT_AGE_18_39
1654      , age_40_59             as PATIENT_AGE_40_59
1655      , age_60_75             as PATIENT_AGE_60_75
1656      , age_76up              as PATIENT_AGE_76_OLDER
1657      , gender_male           as GENDER_IDENTITY_MEN
1658      , gender_female         as GENDER_IDENTITY_WOMEN
1659      , gender_nonbinary      as GENDER_IDENTITY_NB
1660      , gender_none           as GENDER_IDENTITY_UNKNOWN
1661      , demog_data            as DATA_SOURCE
1662  from survey0a;
NOTE: Table WORK.SURVEY1 created, with 49 rows and 43 columns.

1663  quit;
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.07 seconds
      cpu time            0.07 seconds


1663!       *49,43;
1664
1665  * Create calculated variables for 'x_collected';
1666  data survey2;
1667  set  survey1;
1668
1669  if hispanic_latinx_unknown = 100 then ETHNICITY_COLLECTED = 0;
1670      else ETHNICITY_COLLECTED = 1;
1671
1672  if GENDER_IDENTITY_UNKNOWN = 100 then GENDER_COLLECTED = 0;
1673      else GENDER_COLLECTED = 1;
1674
1675  if PERCENTAGE_UNKNOWN = 100 then RACE_COLLECTED = 0;
1676      else RACE_COLLECTED = 1;
1677
1678  Grantee = 'CO';
1679
1680  run;

NOTE: There were 49 observations read from the data set WORK.SURVEY1.
NOTE: The data set WORK.SURVEY2 has 49 observations and 47 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds


1681  *49, 47;
1682
1683  * Recode inpatient care, then drop
1684      > original: 1) Yes, 0) No clinicians visit patients in hosp, -1) No Hospital-based staff
1684! provides
1685      > for norc: 1) Yes, 2) No clinicians visit patients in hosp,  3) No Hospital-based staff
1685! provides;
1686  data survey3;
1687  set  survey2;
1688  if inpatientcare = -1     then INPATIENT_ADMISSIONS = 3;
1689  else if inpatientcare = 0 then INPATIENT_ADMISSIONS = 2;
1690  else if inpatientcare = 1 then INPATIENT_ADMISSIONS = 1;
1691  else INPATIENT_ADMISSIONS = 999;
1692  run;

NOTE: Character values have been converted to numeric values at the places given by: (Line):(Column).
      1688:4   1689:9   1690:9
NOTE: There were 49 observations read from the data set WORK.SURVEY2.
NOTE: The data set WORK.SURVEY3 has 49 observations and 48 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds


1692!      *49, 48;
1693  * original had 34 (-1 --> recode to "3") n=7 (0 --> recoded to "2") and n=5 (1) ;
1694
1695  proc freq data = survey3;
1696  tables inpatient:;
1697  run;

NOTE: There were 49 observations read from the data set WORK.SURVEY3.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.12 seconds
      cpu time            0.09 seconds


1698
1699  data survey4 (drop=inpatientcare);
1700  set  survey3;
1701  run;

NOTE: There were 49 observations read from the data set WORK.SURVEY3.
NOTE: The data set WORK.SURVEY4 has 49 observations and 47 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds


1701!      *49, 47;
1702
1703  /*            * Find instances with >1 practice_id and send to Sabrina Lor;*/
1704  /*            proc sql; */
1705  /*            create table norc.survey_multiple_ids as */
1706  /*            select **/
1707  /*                , count(practice_id)*/
1708  /*            from survey4*/
1709  /*            group by practice_id*/
1710  /*            having count(practice_id) >1;*/
1711  /*            quit;*/
1712  /**/
1713  /*            * exported and sent to Sabrina Lor 08/25/2022;*/
1714  /*                        proc export data = norc.survey_multiple_ids*/
1715  /*                            outfile = "&norc/pracsurvey_mult_&datestamp"*/
1716  /*                            dbms=xlsx replace;*/
1717  /*                        run;*/
1718
1719  /*data survey5;*/
1720  /*set  survey4;*/
1721  /*IF practice_id in (35, 141) then delete; */
1722  /*run; * should drop 5 instances to become 44 > actual: 44, 47;*/
1723
1724  *save to library;
1725  data norc.survey;
1726  set  survey4;
1727  run;

NOTE: There were 49 observations read from the data set WORK.SURVEY4.
NOTE: The data set NORC.SURVEY has 49 observations and 47 variables.
NOTE: DATA statement used (Total process time):
      real time           0.10 seconds
      cpu time            0.03 seconds


1727!      *44, 47;
1728
1729  proc sort data = norc.survey; by practice_id; run;

NOTE: There were 49 observations read from the data set NORC.SURVEY.
NOTE: The data set NORC.SURVEY has 49 observations and 47 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.09 seconds
      cpu time            0.04 seconds


1730
1731  proc freq data = norc.survey;
1732  run;

NOTE: There were 49 observations read from the data set NORC.SURVEY.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.71 seconds
      cpu time            0.67 seconds


1733
1734  * Don't need to export: wait until merged with PracticeApp;

