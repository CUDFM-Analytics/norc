1058  /*
1059  PROGRAM:
1060  PURPOSE:         NORC upload
1061  PROGRAMMER:      K Wiggins
1062  DATE:            08/25/2022
1063  PROCESS:         Sabrina Lor exports REDCap, Qualtrics to S:drive>data_team as <file>_raw_;
1064  NOTES:           These are no longer in file but were in January:
1065                       - Use split_id_verify
1066                       - Use dupdelete remove 1's
1067
1068                   Check:
1069                   - removed 2164 last time - do again? (had 2x records)
1070                   _ no keep / etc columns - all look complete - so kept all.
1071                  - Sent duplicate practice_id's to Sabrina Lor - practice_id 35, 141 this time
1072                   Final result for upload should have 74 columns and be in order acc to
1072! &template_fields;
1073  ---------------------------------------------------------------------------------------------
1073! --------
1074  CHANGE LOG
1075     Date         By      Purpose
1076  1. 01/15/22     KW      Copied from Dionisia's original to not mess with it
1077  2. 08/25/22     KW      Adapted from last iteration survey only, NORC
1078  3. 08/26/22     KW      Removed practice ID's 35, 141 until resolved: Need to get this file
1078! in first for other files' practice_ids
1079
1080  LAST RAN: 08/25/2022
1081  */
1082
1083  * Set global variables and function calls;
1084  * ROOT FOLDER  ---------------------------------------;
1085  %let root = S:/FM/FM/Data_Management_Team;
1086  * INCLUDE --------------------------------------------;
1087  %include "&root/norc/code_folder/00_paths_lets.sas";
SYMBOLGEN:  Macro variable ROOT resolves to S:/FM/FM/Data_Management_Team
SYMBOLGEN:  Macro variable ROOT resolves to S:/FM/FM/Data_Management_Team
SYMBOLGEN:  Macro variable ROOT resolves to S:/FM/FM/Data_Management_Team
SYMBOLGEN:  Macro variable ROOT resolves to S:/FM/FM/Data_Management_Team
SYMBOLGEN:  Macro variable ROOT resolves to S:/FM/FM/Data_Management_Team
SYMBOLGEN:  Macro variable ROOT resolves to S:/FM/FM/Data_Management_Team
SYMBOLGEN:  Macro variable FORM resolves to S:/FM/FM/Data_Management_Team/norc/background
SYMBOLGEN:  Macro variable DATA resolves to S:/FM/FM/Data_Management_Team/raw data
SYMBOLGEN:  Macro variable DATA resolves to S:/FM/FM/Data_Management_Team/raw data
SYMBOLGEN:  Macro variable DATA resolves to S:/FM/FM/Data_Management_Team/raw data
SYMBOLGEN:  Macro variable DATA resolves to S:/FM/FM/Data_Management_Team/raw data
SYMBOLGEN:  Macro variable DATA resolves to S:/FM/FM/Data_Management_Team/raw data
SYMBOLGEN:  Macro variable DATA resolves to S:/FM/FM/Data_Management_Team/raw data
SYMBOLGEN:  Macro variable DATA resolves to S:/FM/FM/Data_Management_Team/raw data
SYMBOLGEN:  Macro variable ONEDRIVE resolves to C:/Users/wigginki/OneDrive - The University of
            Colorado Denver/Documents/projects
NOTE: Format PCTFMT is already on the library WORK.FORMATS.
NOTE: Format PCTFMT has been output.

NOTE: PROCEDURE FORMAT used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds


NOTE: Writing HTML Body file: sashtml2.htm
WARNING: Could not restore referenced object: Base.Freq.Expected.
WARNING: Could not find parent template: Base.Freq.Expected.
WARNING: Could not restore referenced object: Base.Freq.Deviation.
WARNING: Could not find parent template: Base.Freq.Deviation.
WARNING: Could not restore referenced object: Base.Freq.PearsonResidual.
WARNING: Could not find parent template: Base.Freq.PearsonResidual.
WARNING: Could not restore referenced object: Base.Freq.CellChiSquare.
WARNING: Could not find parent template: Base.Freq.CellChiSquare.
NOTE: Overwriting existing template/link: Base.Freq.OneWayList
NOTE: TABLE 'Base.Freq.OneWayList' has been saved to: SASUSER.TEMPLAT
NOTE: PROCEDURE TEMPLATE used (Total process time):
      real time           0.24 seconds
      cpu time            0.11 seconds



NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds


SYMBOLGEN:  Macro variable DATESTAMP resolves to 20220826
20220826
SYMBOLGEN:  Macro variable NORC resolves to S:/FM/FM/Data_Management_Team/norc/results
NOTE: Libref NORC was successfully assigned as follows:
      Engine:        V9
      Physical Name: S:\FM\FM\Data_Management_Team\norc\results
1157           *has paths and all let statements for project;
1158
1159  proc import
1160          file = "&survey."
SYMBOLGEN:  Macro variable SURVEY resolves to S:/FM/FM/Data_Management_Team/raw
            data/FASTPracticeSurvey_raw_08222022.csv
1161          out = survey0
1162          dbms = csv replace;
1163  run;

1163!      *49,69;
1164   /**********************************************************************
1165   *   PRODUCT:   SAS
1166   *   VERSION:   9.4
1167   *   CREATOR:   External File Interface
1168   *   DATE:      26AUG22
1169   *   DESC:      Generated SAS Datastep Code
1170   *   TEMPLATE SOURCE:  (None Specified.)
1171   ***********************************************************************/
1172      data WORK.SURVEY0    ;
1173      %let _EFIERR_ = 0; /* set the ERROR detection macro variable */
1174      infile 'S:/FM/FM/Data_Management_Team/raw data/FASTPracticeSurvey_raw_08222022.csv'
1174! delimiter = ',' MISSOVER DSD lrecl=32767 firstobs=2 ;
1175         informat recordid best32. ;
1176         informat prac_entity_split_id best32. ;
1177         informat name $53. ;
1178         informat zip best32. ;
1179         informat state $1. ;
1180         informat survey_dtd yymmdd10. ;
1181         informat consulted___1 best32. ;
1182         informat consulted___2 best32. ;
1183         informat consulted___3 best32. ;
1184         informat consulted___4 best32. ;
1185         informat consulted___5 best32. ;
1186         informat consulted___6 best32. ;
1187         informat consulted___7 best32. ;
1188         informat consulted___8 best32. ;
1189         informat consulted_other $1. ;
1190         informat num_primary best32. ;
1191         informat fte_primary best32. ;
1192         informat num_psych best32. ;
1193         informat fte_psych best32. ;
1194         informat num_bhav best32. ;
1195         informat fte_bhav best32. ;
1196         informat num_nursing best32. ;
1197         informat num_front_office best32. ;
1198         informat num_peer_pvdr best32. ;
1199         informat num_pharm best32. ;
1200         informat num_other best32. ;
1201         informat patient_visits_wk best32. ;
1202         informat patient_provider_day best32. ;
1203         informat inpatientcare $5. ;
1204         informat race_white best32. ;
1205         informat race_black best32. ;
1206         informat race_native best32. ;
1207         informat race_hawaiian best32. ;
1208         informat race_asian best32. ;
1209         informat race_other best32. ;
1210         informat race_unknown best32. ;
1211         informat hispanic best32. ;
1212         informat non_hispanic best32. ;
1213         informat hispanic_unknown best32. ;
1214         informat age_0_17 best32. ;
1215         informat age_18_39 best32. ;
1216         informat age_40_59 best32. ;
1217         informat age_60_75 best32. ;
1218         informat age_76up best32. ;
1219         informat age_unk best32. ;
1220         informat gender_male best32. ;
1221         informat gender_female best32. ;
1222         informat gender_nonbinary best32. ;
1223         informat gender_none best32. ;
1224         informat demog_data best32. ;
1225         informat underserved best32. ;
1226         informat registry___1 best32. ;
1227         informat registry___2 best32. ;
1228         informat registry___3 best32. ;
1229         informat registry___4 best32. ;
1230         informat registry___5 best32. ;
1231         informat registry___6 best32. ;
1232         informat registry___7 best32. ;
1233         informat registry___8 best32. ;
1234         informat registry___9 best32. ;
1235         informat registry_config best32. ;
1236         informat teamlearn_formal_train $6. ;
1237         informat teamlearn_how_train best32. ;
1238         informat teamlearn_name_training best32. ;
1239         informat teamlearn_name_train_specify $60. ;
1240         informat train_together best32. ;
1241         informat train_small_teams best32. ;
1242         informat train_idv best32. ;
1243         informat fast_practice_survey_complete best32. ;
1244         format recordid best12. ;
1245         format prac_entity_split_id best12. ;
1246         format name $53. ;
1247         format zip best12. ;
1248         format state $1. ;
1249         format survey_dtd yymmdd10. ;
1250         format consulted___1 best12. ;
1251         format consulted___2 best12. ;
1252         format consulted___3 best12. ;
1253         format consulted___4 best12. ;
1254         format consulted___5 best12. ;
1255         format consulted___6 best12. ;
1256         format consulted___7 best12. ;
1257         format consulted___8 best12. ;
1258         format consulted_other $1. ;
1259         format num_primary best12. ;
1260         format fte_primary best12. ;
1261         format num_psych best12. ;
1262         format fte_psych best12. ;
1263         format num_bhav best12. ;
1264         format fte_bhav best12. ;
1265         format num_nursing best12. ;
1266         format num_front_office best12. ;
1267         format num_peer_pvdr best12. ;
1268         format num_pharm best12. ;
1269         format num_other best12. ;
1270         format patient_visits_wk best12. ;
1271         format patient_provider_day best12. ;
1272         format inpatientcare $5. ;
1273         format race_white best12. ;
1274         format race_black best12. ;
1275         format race_native best12. ;
1276         format race_hawaiian best12. ;
1277         format race_asian best12. ;
1278         format race_other best12. ;
1279         format race_unknown best12. ;
1280         format hispanic best12. ;
1281         format non_hispanic best12. ;
1282         format hispanic_unknown best12. ;
1283         format age_0_17 best12. ;
1284         format age_18_39 best12. ;
1285         format age_40_59 best12. ;
1286         format age_60_75 best12. ;
1287         format age_76up best12. ;
1288         format age_unk best12. ;
1289         format gender_male best12. ;
1290         format gender_female best12. ;
1291         format gender_nonbinary best12. ;
1292         format gender_none best12. ;
1293         format demog_data best12. ;
1294         format underserved best12. ;
1295         format registry___1 best12. ;
1296         format registry___2 best12. ;
1297         format registry___3 best12. ;
1298         format registry___4 best12. ;
1299         format registry___5 best12. ;
1300         format registry___6 best12. ;
1301         format registry___7 best12. ;
1302         format registry___8 best12. ;
1303         format registry___9 best12. ;
1304         format registry_config best12. ;
1305         format teamlearn_formal_train $6. ;
1306         format teamlearn_how_train best12. ;
1307         format teamlearn_name_training best12. ;
1308         format teamlearn_name_train_specify $60. ;
1309         format train_together best12. ;
1310         format train_small_teams best12. ;
1311         format train_idv best12. ;
1312         format fast_practice_survey_complete best12. ;
1313      input
1314                  recordid
1315                  prac_entity_split_id
1316                  name  $
1317                  zip
1318                  state  $
1319                  survey_dtd
1320                  consulted___1
1321                  consulted___2
1322                  consulted___3
1323                  consulted___4
1324                  consulted___5
1325                  consulted___6
1326                  consulted___7
1327                  consulted___8
1328                  consulted_other  $
1329                  num_primary
1330                  fte_primary
1331                  num_psych
1332                  fte_psych
1333                  num_bhav
1334                  fte_bhav
1335                  num_nursing
1336                  num_front_office
1337                  num_peer_pvdr
1338                  num_pharm
1339                  num_other
1340                  patient_visits_wk
1341                  patient_provider_day
1342                  inpatientcare  $
1343                  race_white
1344                  race_black
1345                  race_native
1346                  race_hawaiian
1347                  race_asian
1348                  race_other
1349                  race_unknown
1350                  hispanic
1351                  non_hispanic
1352                  hispanic_unknown
1353                  age_0_17
1354                  age_18_39
1355                  age_40_59
1356                  age_60_75
1357                  age_76up
1358                  age_unk
1359                  gender_male
1360                  gender_female
1361                  gender_nonbinary
1362                  gender_none
1363                  demog_data
1364                  underserved
1365                  registry___1
1366                  registry___2
1367                  registry___3
1368                  registry___4
1369                  registry___5
1370                  registry___6
1371                  registry___7
1372                  registry___8
1373                  registry___9
1374                  registry_config
1375                  teamlearn_formal_train  $
1376                  teamlearn_how_train
1377                  teamlearn_name_training
1378                  teamlearn_name_train_specify  $
1379                  train_together
1380                  train_small_teams
1381                  train_idv
1382                  fast_practice_survey_complete
1383      ;
1384      if _ERROR_ then call symputx('_EFIERR_',1);  /* set ERROR detection macro variable */
1385      run;

NOTE: The infile 'S:/FM/FM/Data_Management_Team/raw data/FASTPracticeSurvey_raw_08222022.csv' is:
      Filename=S:\FM\FM\Data_Management_Team\raw data\FASTPracticeSurvey_raw_08222022.csv,
      RECFM=V,LRECL=32767,File Size (bytes)=10977,
      Last Modified=22Aug2022:10:58:03,
      Create Time=22Aug2022:11:01:54

NOTE: 49 records were read from the infile 'S:/FM/FM/Data_Management_Team/raw
      data/FASTPracticeSurvey_raw_08222022.csv'.
      The minimum record length was 161.
      The maximum record length was 293.
NOTE: The data set WORK.SURVEY0 has 49 observations and 69 variables.
NOTE: DATA statement used (Total process time):
      real time           0.06 seconds
      cpu time            0.04 seconds


49 rows created in WORK.SURVEY0 from S:/FM/FM/Data_Management_Team/raw
data/FASTPracticeSurvey_raw_08222022.csv.



NOTE: WORK.SURVEY0 data set was successfully created.
NOTE: The data set WORK.SURVEY0 has 49 observations and 69 variables.
NOTE: PROCEDURE IMPORT used (Total process time):
      real time           0.41 seconds
      cpu time            0.11 seconds


1386
1387  proc sql;
1388  create table survey1 as
1389  select prac_entity_split_id as PRACTICE_ID
1390      , zip                   as ZIPCODE
1391      , consulted___1         as SURVEY_CONSULT_CLINICIAN
1392      , consulted___2         as SURVEY_CONSULT_BH
1393      , consulted___3         as SURVEY_CONSULT_OTHER_CLINICAL
1394      , consulted___4         as SURVEY_CONSULT_OFFICE_MANAGER
1395      , consulted___5         as SURVEY_CONSULT_OFFICE_STAFF
1396      , consulted___6         as SURVEY_CONSULT_PEER_PROVIDER
1397      , consulted___7         as SURVEY_CONSULT_PHARMACIST
1398      , consulted_other       as SURVEY_CONSULT_OTHER
1399      , num_primary           as TOTAL_PRIMARY_CARE
1400      , fte_primary           as FTE_PRIMARY_CARE
1401      , num_psych             as TOTAL_PSYCH
1402      , fte_psych             as FTE_PSYCH
1403      , num_bhav              as TOTAL_BH
1404      , fte_bhav              as FTE_BH
1405      , num_nursing           as TOTAL_DIRECT_PT_CARE
1406      , num_front_office      as TOTAL_OFFICE_STAFF
1407      , num_peer_pvdr         as TOTAL_PEER_PROVIDERS
1408      , num_pharm             as TOTAL_PHARMACIST
1409      , num_other             as TOTAL_OTHER
1410      , inpatientcare
1411      , patient_provider_day  as PATIENT_DAILY_NUMBER
1412      , race_white            as PERCENTAGE_WHITE
1413      , race_black            as PERCENTAGE_BLACK
1414      , race_native           as PERCENTAGE_AIAN
1415      , race_asian            as PERCENTAGE_ASIAN
1416      , race_hawaiian         as PERCENTAGE_NHPI
1417      , race_other            as PERCENTAGE_OTHER_MIXED
1418      , race_unknown          as PERCENTAGE_UNKNOWN
1419      , hispanic              as HISPANIC_LATINX_PERCENT
1420      , non_hispanic          as NON_HISPANIC_LATINX
1421      , hispanic_unknown      as HISPANIC_LATINX_UNKNOWN
1422      , age_0_17              as PATIENT_AGE_0_17
1423      , age_18_39             as PATIENT_AGE_18_39
1424      , age_40_59             as PATIENT_AGE_40_59
1425      , age_60_75             as PATIENT_AGE_60_75
1426      , age_76up              as PATIENT_AGE_76_OLDER
1427      , gender_male           as GENDER_IDENTITY_MEN
1428      , gender_female         as GENDER_IDENTITY_WOMEN
1429      , gender_nonbinary      as GENDER_IDENTITY_NB
1430      , gender_none           as GENDER_IDENTITY_UNKNOWN
1431      , demog_data            as DATA_SOURCE
1432  from survey0;
NOTE: Table WORK.SURVEY1 created, with 49 rows and 43 columns.

1433  quit;
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.02 seconds
      cpu time            0.01 seconds


1433!       *49,43;
1434
1435  * Create calculated variables for 'x_collected';
1436  data survey2;
1437  set  survey1;
1438
1439  if hispanic_latinx_unknown = 100 then ETHNICITY_COLLECTED = 0;
1440      else ETHNICITY_COLLECTED = 1;
1441
1442  if GENDER_IDENTITY_UNKNOWN = 100 then GENDER_COLLECTED = 0;
1443      else GENDER_COLLECTED = 1;
1444
1445  if PERCENTAGE_UNKNOWN = 100 then RACE_COLLECTED = 0;
1446      else RACE_COLLECTED = 1;
1447
1448  Grantee = 'CO';
1449
1450  run;

NOTE: There were 49 observations read from the data set WORK.SURVEY1.
NOTE: The data set WORK.SURVEY2 has 49 observations and 47 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds


1451  *49, 47;
1452
1453
1454  * Recode inpatient care, then drop
1455      > original: 1) Yes, 0) No clinicians visit patients in hosp, -1) No Hospital-based staff
1455! provides
1456      > for norc: 1) Yes, 2) No clinicians visit patients in hosp,  3) No Hospital-based staff
1456! provides;
1457  data survey3;
1458  set  survey2;
1459  if inpatientcare = -1     then INPATIENT_ADMISSIONS = 3;
1460  else if inpatientcare = 0 then INPATIENT_ADMISSIONS = 2;
1461  else if inpatientcare = 1 then INPATIENT_ADMISSIONS = 1;
1462  else INPATIENT_ADMISSIONS = 999;
1463  run;

NOTE: Character values have been converted to numeric values at the places given by:
      (Line):(Column).
      1459:4   1460:9   1461:9
NOTE: There were 49 observations read from the data set WORK.SURVEY2.
NOTE: The data set WORK.SURVEY3 has 49 observations and 48 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds


1463!      *49, 48;
1464  * original had 34 (-1 --> recode to "3") n=7 (0 --> recoded to "2") and n=5 (1) ;
1465
1466  proc freq data = survey3;
1467  tables inpatient:;
1468  run;

WARNING: Could not restore referenced object: Base.Freq.CellChiSquare.
WARNING: Could not find parent template: Base.Freq.CellChiSquare.
WARNING: Could not restore referenced object: Base.Freq.PearsonResidual.
WARNING: Could not find parent template: Base.Freq.PearsonResidual.
WARNING: Could not restore referenced object: Base.Freq.Deviation.
WARNING: Could not find parent template: Base.Freq.Deviation.
WARNING: Could not restore referenced object: Base.Freq.Expected.
WARNING: Could not find parent template: Base.Freq.Expected.
NOTE: There were 49 observations read from the data set WORK.SURVEY3.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.04 seconds
      cpu time            0.01 seconds


1469
1470  data survey4 (drop=inpatientcare);
1471  set  survey3;
1472  run;

NOTE: There were 49 observations read from the data set WORK.SURVEY3.
NOTE: The data set WORK.SURVEY4 has 49 observations and 47 variables.
NOTE: DATA statement used (Total process time):
      real time           0.02 seconds
      cpu time            0.01 seconds


1472!      *49, 47;
1473
1474
1475
1476              * Find instances with >1 practice_id and send to Sabrina Lor;
1477              proc sql;
1478              create table norc.survey_multiple_ids as
1479              select *
1480                  , count(practice_id)
1481              from survey0
1482              group by practice_id
1483              having count(practice_id) >1;
ERROR: The following columns were not found in the contributing tables: practice_id.
1484              quit;
NOTE: The SAS System stopped processing this step because of errors.
NOTE: PROCEDURE SQL used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds

1485
1486              * exported and sent to Sabrina Lor 08/25/2022;


1487                          proc export data = norc.survey_multiple_ids
1488                              outfile = "&norc/pracsurvey_mult_&datestamp"
SYMBOLGEN:  Macro variable NORC resolves to S:/FM/FM/Data_Management_Team/norc/results
SYMBOLGEN:  Macro variable DATESTAMP resolves to 20220826
1489                              dbms=xlsx replace;
1490                          run;

NOTE: The export data set has 5 observations and 70 variables.
NOTE: "S:\FM\FM\Data_Management_Team\norc\results\pracsurvey_mult_20220826.xlsx" file was
      successfully created.
NOTE: PROCEDURE EXPORT used (Total process time):
      real time           0.68 seconds
      cpu time            0.00 seconds


1491
1492  data survey5;
1493  set  survey4;
1494  IF practice_id in (35, 141) then delete;
1495  run;

NOTE: There were 49 observations read from the data set WORK.SURVEY4.
NOTE: The data set WORK.SURVEY5 has 44 observations and 47 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds


1495!      * should drop 5 instances to become 44 > actual: 44, 47;
1496
1497  * Change all missing variables to 999;
1498  proc stdize data=survey5
1499      out         =survey6
1500      reponly missing=999;
1501  run;

NOTE: No VAR statement is given. All numerical variables not named elsewhere make up the first set
      of variables.
NOTE: There were 44 observations read from the data set WORK.SURVEY5.
NOTE: The data set WORK.SURVEY6 has 44 observations and 47 variables.
NOTE: PROCEDURE STDIZE used (Total process time):
      real time           0.01 seconds
      cpu time            0.00 seconds


1502
1503  data norc.survey;
1504  set  survey6;
1505  run;

NOTE: There were 44 observations read from the data set WORK.SURVEY6.
NOTE: The data set NORC.SURVEY has 44 observations and 47 variables.
NOTE: DATA statement used (Total process time):
      real time           0.31 seconds
      cpu time            0.03 seconds


1505!      *44, 47;
1506
1507  proc sort data = norc.survey; by practice_id; run;

NOTE: There were 44 observations read from the data set NORC.SURVEY.
NOTE: The data set NORC.SURVEY has 44 observations and 47 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.36 seconds
      cpu time            0.04 seconds


1508
1509  proc freq data = norc.survey;
1510  run;

WARNING: Could not restore referenced object: Base.Freq.CellChiSquare.
WARNING: Could not find parent template: Base.Freq.CellChiSquare.
WARNING: Could not restore referenced object: Base.Freq.PearsonResidual.
WARNING: Could not find parent template: Base.Freq.PearsonResidual.
WARNING: Could not restore referenced object: Base.Freq.Deviation.
WARNING: Could not find parent template: Base.Freq.Deviation.
WARNING: Could not restore referenced object: Base.Freq.Expected.
WARNING: Could not find parent template: Base.Freq.Expected.
NOTE: There were 44 observations read from the data set NORC.SURVEY.
NOTE: PROCEDURE FREQ used (Total process time):
      real time           0.14 seconds
      cpu time            0.07 seconds


1511
1512  * Don't need to export: wait until merged with PracticeApp;

